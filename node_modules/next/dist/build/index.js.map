{"version":3,"sources":["../../build/index.ts"],"names":["staticCheckWorker","require","resolve","build","dir","conf","reactProductionProfiling","debugOutput","Error","loadedEnvFiles","Log","config","PHASE_PRODUCTION_BUILD","target","buildId","generateBuildId","nanoid","distDir","path","join","headers","rewrites","redirects","ciEnvironment","isCI","hasNextSupport","cacheDir","hasCache","console","log","prefixes","warn","buildSpinner","prefixText","info","telemetry","Telemetry","publicDir","pagesDir","hasPublicDir","record","cliCommand","isSrcDir","relative","startsWith","hasNowJson","cwd","isCustomServer","then","events","ignoreTypeScriptErrors","Boolean","typescript","ignoreBuildErrors","tracer","experimental","profiling","createTrace","profiler","startProfiling","isLikeServerless","pagePaths","pageExtensions","allStaticPages","Set","allPageInfos","Map","previewProps","previewModeId","crypto","randomBytes","toString","previewModeSigningKey","previewModeEncryptionKey","mappedPages","entrypoints","pageKeys","Object","keys","conflictingPublicFiles","hasCustomErrorPage","hasPages404","hasNonStaticErrorPage","hasPublicUnderScoreNextDir","PUBLIC_DIR_MIDDLEWARE_CONFLICT","page","hasPublicPageFile","push","numConflicting","length","nestedReservedPages","filter","match","dirname","buildCustomRoute","r","type","basePath","i18n","locale","source","destination","locales","map","routeRegex","strict","sensitive","delimiter","statusCode","permanent","undefined","regex","routesManifestPath","ROUTES_MANIFEST","routesManifest","version","pages404","dynamicRoutes","isDynamicRoute","re","routeKeys","namedRegex","dataRoutes","promises","mkdir","recursive","writeFile","JSON","stringify","configs","Promise","all","isServer","client","server","clientConfig","optimization","minimize","minimizer","webpackBuildStart","process","hrtime","result","warnings","errors","clientResult","serverResult","webpackBuildEnd","stopAndPersist","error","chalk","red","indexOf","page_name_regex","parsed","exec","page_name","groups","durationInSeconds","postCompileSpinner","manifestPath","SERVERLESS_DIRECTORY","SERVER_DIRECTORY","PAGES_MANIFEST","buildManifestPath","BUILD_MANIFEST","ssgPages","ssgStaticFallbackPages","ssgBlockingFallbackPages","staticPages","invalidPages","hybridAmpPages","serverPropsPages","additionalSsgPaths","pageInfos","pagesManifest","parse","readFile","buildManifest","customAppGetInitialProps","namedExports","isNextImageImported","env","NEXT_PHASE","staticCheckWorkers","Worker","numWorkers","cpus","enableWorkerThreads","workerThreads","getStdout","pipe","stdout","getStderr","stderr","runtimeEnvConfig","publicRuntimeConfig","serverRuntimeConfig","analysisBegin","actualPage","selfSize","allSize","isSsg","isStatic","isHybridAmp","ssgPageRoutes","nonReservedPage","serverBundle","bold","yellow","workerResult","isPageStatic","defaultLocale","add","hasStaticProps","prerenderRoutes","set","prerenderFallback","hasServerProps","PAGES_404_GET_INITIAL_PROPS_ERROR","delete","err","message","size","totalSize","static","initialRevalidateSeconds","end","pagePath","dataRoute","posix","dataRouteRegex","namedDataRouteRegex","replace","RegExp","useStatic404","pg","finalPrerenderRoutes","tbdPrerenderRoutes","ssgNotFoundPaths","combinedPages","exportApp","default","exportOptions","silent","buildExport","threads","pages","outdir","statusMessage","exportConfig","initialPageRevalidationMap","exportPathMap","defaultMap","forEach","has","query","__nextFallback","routes","route","isDynamic","isFallback","outputPath","__nextLocale","trailingSlash","postBuildSpinner","unlink","serverOutputDir","moveExportedPage","originPage","file","ext","additionalSsgFile","orig","relativeDest","substr","split","dest","isNotFound","includes","rename","curPath","localeExt","extname","relativeDestNoPages","updatedRelativeDest","updatedOrig","updatedDest","isStaticSsgFallback","hasAmp","ampPage","revalidationMapPath","srcRoute","pageInfo","get","extraRoutes","pageFile","rmdir","analysisEnd","staticPageCount","staticPropsPageCount","serverPropsPageCount","ssrPageCount","hasStatic404","hasReportWebVitals","rewritesCount","headersCount","redirectsCount","finalDynamicRoutes","tbdRoute","normalizedRoute","fallback","prerenderManifest","notFoundRoutes","preview","PRERENDER_MANIFEST","generateClientSsgManifest","images","deviceSizes","imageSizes","sizes","IMAGES_MANIFEST","EXPORT_MARKER","hasExportPathMap","exportTrailingSlash","EXPORT_DETAIL","catch","code","reject","key","distPath","analyticsId","green","parsedResults","stopProfiling","destroy","trace","flush","cpuStartTime","profile","startTime","cpuEndTime","endTime","completeEvent","name","id","counter","cat","ts","args","src_file","src_func","dur","data","url","lineNumber","columnNumber","frame","instantEvent","cpuProfile","entries","clientSsgManifestContent","CLIENT_STATIC_FILES_PATH"],"mappings":"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","sourcesContent":["import crypto from 'crypto'\nimport { promises, writeFileSync } from 'fs'\nimport Worker from 'jest-worker'\nimport chalk from 'chalk'\nimport devalue from 'next/dist/compiled/devalue'\nimport escapeStringRegexp from 'next/dist/compiled/escape-string-regexp'\nimport findUp from 'next/dist/compiled/find-up'\nimport nanoid from 'next/dist/compiled/nanoid/index.js'\nimport { pathToRegexp } from 'next/dist/compiled/path-to-regexp'\nimport path from 'path'\nimport formatWebpackMessages from '../client/dev/error-overlay/format-webpack-messages'\nimport {\n  PAGES_404_GET_INITIAL_PROPS_ERROR,\n  PUBLIC_DIR_MIDDLEWARE_CONFLICT,\n} from '../lib/constants'\nimport { fileExists } from '../lib/file-exists'\nimport { findPagesDir } from '../lib/find-pages-dir'\nimport loadCustomRoutes, {\n  getRedirectStatus,\n  normalizeRouteRegex,\n  Redirect,\n  RouteType,\n} from '../lib/load-custom-routes'\nimport { loadEnvConfig } from '@next/env'\nimport { recursiveDelete } from '../lib/recursive-delete'\nimport { verifyTypeScriptSetup } from '../lib/verifyTypeScriptSetup'\nimport {\n  BUILD_MANIFEST,\n  CLIENT_STATIC_FILES_PATH,\n  EXPORT_DETAIL,\n  EXPORT_MARKER,\n  IMAGES_MANIFEST,\n  PAGES_MANIFEST,\n  PHASE_PRODUCTION_BUILD,\n  PRERENDER_MANIFEST,\n  ROUTES_MANIFEST,\n  SERVERLESS_DIRECTORY,\n  SERVER_DIRECTORY,\n} from '../next-server/lib/constants'\nimport {\n  getRouteRegex,\n  getSortedRoutes,\n  isDynamicRoute,\n} from '../next-server/lib/router/utils'\nimport { __ApiPreviewProps } from '../next-server/server/api-utils'\nimport loadConfig, {\n  isTargetLikeServerless,\n} from '../next-server/server/config'\nimport { BuildManifest } from '../next-server/server/get-page-files'\nimport '../next-server/server/node-polyfill-fetch'\nimport { normalizePagePath } from '../next-server/server/normalize-page-path'\nimport { getPagePath } from '../next-server/server/require'\nimport * as ciEnvironment from '../telemetry/ci-info'\nimport {\n  eventBuildCompleted,\n  eventBuildOptimize,\n  eventCliSession,\n  eventNextPlugins,\n} from '../telemetry/events'\nimport { Telemetry } from '../telemetry/storage'\nimport { CompilerResult, runCompiler } from './compiler'\nimport { createEntrypoints, createPagesMapping } from './entries'\nimport { generateBuildId } from './generate-build-id'\nimport { isWriteable } from './is-writeable'\nimport createSpinner from './spinner'\nimport {\n  collectPages,\n  getJsPageSizeInKb,\n  getNamedExports,\n  hasCustomGetInitialProps,\n  isPageStatic,\n  PageInfo,\n  printCustomRoutes,\n  printTreeView,\n} from './utils'\nimport getBaseWebpackConfig from './webpack-config'\nimport { PagesManifest } from './webpack/plugins/pages-manifest-plugin'\nimport { writeBuildId } from './write-build-id'\nimport * as Log from './output/log'\n\nconst staticCheckWorker = require.resolve('./utils')\n\nexport type SsgRoute = {\n  initialRevalidateSeconds: number | false\n  srcRoute: string | null\n  dataRoute: string\n}\n\nexport type DynamicSsgRoute = {\n  routeRegex: string\n  fallback: string | null | false\n  dataRoute: string\n  dataRouteRegex: string\n}\n\nexport type PrerenderManifest = {\n  version: 2\n  routes: { [route: string]: SsgRoute }\n  dynamicRoutes: { [route: string]: DynamicSsgRoute }\n  notFoundRoutes: string[]\n  preview: __ApiPreviewProps\n}\n\nexport default async function build(\n  dir: string,\n  conf = null,\n  reactProductionProfiling = false,\n  debugOutput = false\n): Promise<void> {\n  if (!(await isWriteable(dir))) {\n    throw new Error(\n      '> Build directory is not writeable. https://err.sh/vercel/next.js/build-dir-not-writeable'\n    )\n  }\n\n  // attempt to load global env values so they are available in next.config.js\n  const { loadedEnvFiles } = loadEnvConfig(dir, false, Log)\n\n  const config = loadConfig(PHASE_PRODUCTION_BUILD, dir, conf)\n  const { target } = config\n  const buildId = await generateBuildId(config.generateBuildId, nanoid)\n  const distDir = path.join(dir, config.distDir)\n\n  const { headers, rewrites, redirects } = await loadCustomRoutes(config)\n\n  if (ciEnvironment.isCI && !ciEnvironment.hasNextSupport) {\n    const cacheDir = path.join(distDir, 'cache')\n    const hasCache = await fileExists(cacheDir)\n\n    if (!hasCache) {\n      // Intentionally not piping to stderr in case people fail in CI when\n      // stderr is detected.\n      console.log(\n        `${Log.prefixes.warn} No build cache found. Please configure build caching for faster rebuilds. Read more: https://err.sh/next.js/no-cache`\n      )\n    }\n  }\n\n  const buildSpinner = createSpinner({\n    prefixText: `${Log.prefixes.info} Creating an optimized production build`,\n  })\n\n  const telemetry = new Telemetry({ distDir })\n\n  const publicDir = path.join(dir, 'public')\n  const pagesDir = findPagesDir(dir)\n  const hasPublicDir = await fileExists(publicDir)\n\n  telemetry.record(\n    eventCliSession(PHASE_PRODUCTION_BUILD, dir, {\n      cliCommand: 'build',\n      isSrcDir: path.relative(dir, pagesDir!).startsWith('src'),\n      hasNowJson: !!(await findUp('now.json', { cwd: dir })),\n      isCustomServer: null,\n    })\n  )\n\n  eventNextPlugins(path.resolve(dir)).then((events) => telemetry.record(events))\n\n  const ignoreTypeScriptErrors = Boolean(config.typescript?.ignoreBuildErrors)\n  await verifyTypeScriptSetup(dir, pagesDir, !ignoreTypeScriptErrors)\n\n  let tracer: any = null\n  if (config.experimental.profiling) {\n    const { createTrace } = require('./profiler/profiler.js')\n    tracer = createTrace(path.join(distDir, `profile-events.json`))\n    tracer.profiler.startProfiling()\n  }\n\n  const isLikeServerless = isTargetLikeServerless(target)\n\n  const pagePaths: string[] = await collectPages(\n    pagesDir,\n    config.pageExtensions\n  )\n\n  // needed for static exporting since we want to replace with HTML\n  // files\n  const allStaticPages = new Set<string>()\n  let allPageInfos = new Map<string, PageInfo>()\n\n  const previewProps: __ApiPreviewProps = {\n    previewModeId: crypto.randomBytes(16).toString('hex'),\n    previewModeSigningKey: crypto.randomBytes(32).toString('hex'),\n    previewModeEncryptionKey: crypto.randomBytes(32).toString('hex'),\n  }\n\n  const mappedPages = createPagesMapping(pagePaths, config.pageExtensions)\n  const entrypoints = createEntrypoints(\n    mappedPages,\n    target,\n    buildId,\n    previewProps,\n    config,\n    loadedEnvFiles\n  )\n  const pageKeys = Object.keys(mappedPages)\n  const conflictingPublicFiles: string[] = []\n  const hasCustomErrorPage = mappedPages['/_error'].startsWith(\n    'private-next-pages'\n  )\n  const hasPages404 = Boolean(\n    mappedPages['/404'] && mappedPages['/404'].startsWith('private-next-pages')\n  )\n  let hasNonStaticErrorPage: boolean\n\n  if (hasPublicDir) {\n    const hasPublicUnderScoreNextDir = await fileExists(\n      path.join(publicDir, '_next')\n    )\n    if (hasPublicUnderScoreNextDir) {\n      throw new Error(PUBLIC_DIR_MIDDLEWARE_CONFLICT)\n    }\n  }\n\n  // Check if pages conflict with files in `public`\n  // Only a page of public file can be served, not both.\n  for (const page in mappedPages) {\n    const hasPublicPageFile = await fileExists(\n      path.join(publicDir, page === '/' ? '/index' : page),\n      'file'\n    )\n    if (hasPublicPageFile) {\n      conflictingPublicFiles.push(page)\n    }\n  }\n\n  const numConflicting = conflictingPublicFiles.length\n\n  if (numConflicting) {\n    throw new Error(\n      `Conflicting public and page file${\n        numConflicting === 1 ? ' was' : 's were'\n      } found. https://err.sh/vercel/next.js/conflicting-public-file-page\\n${conflictingPublicFiles.join(\n        '\\n'\n      )}`\n    )\n  }\n\n  const nestedReservedPages = pageKeys.filter((page) => {\n    return (\n      page.match(/\\/(_app|_document|_error)$/) && path.dirname(page) !== '/'\n    )\n  })\n\n  if (nestedReservedPages.length) {\n    Log.warn(\n      `The following reserved Next.js pages were detected not directly under the pages directory:\\n` +\n        nestedReservedPages.join('\\n') +\n        `\\nSee more info here: https://err.sh/next.js/nested-reserved-page\\n`\n    )\n  }\n\n  const buildCustomRoute = (\n    r: {\n      source: string\n      locale?: false\n      basePath?: false\n      statusCode?: number\n      destination?: string\n    },\n    type: RouteType\n  ) => {\n    const keys: any[] = []\n\n    if (r.basePath !== false && (!config.i18n || r.locale === false)) {\n      r.source = `${config.basePath}${r.source}`\n\n      if (r.destination && r.destination.startsWith('/')) {\n        r.destination = `${config.basePath}${r.destination}`\n      }\n    }\n\n    if (config.i18n && r.locale !== false) {\n      const basePath = r.basePath !== false ? config.basePath || '' : ''\n\n      r.source = `${basePath}/:nextInternalLocale(${config.i18n.locales\n        .map((locale: string) => escapeStringRegexp(locale))\n        .join('|')})${r.source}`\n\n      if (r.destination && r.destination?.startsWith('/')) {\n        r.destination = `${basePath}/:nextInternalLocale${r.destination}`\n      }\n    }\n\n    const routeRegex = pathToRegexp(r.source, keys, {\n      strict: true,\n      sensitive: false,\n      delimiter: '/', // default is `/#?`, but Next does not pass query info\n    })\n\n    return {\n      ...r,\n      ...(type === 'redirect'\n        ? {\n            statusCode: getRedirectStatus(r as Redirect),\n            permanent: undefined,\n          }\n        : {}),\n      regex: normalizeRouteRegex(routeRegex.source),\n    }\n  }\n\n  const routesManifestPath = path.join(distDir, ROUTES_MANIFEST)\n  const routesManifest: {\n    version: number\n    pages404: boolean\n    basePath: string\n    redirects: Array<ReturnType<typeof buildCustomRoute>>\n    rewrites: Array<ReturnType<typeof buildCustomRoute>>\n    headers: Array<ReturnType<typeof buildCustomRoute>>\n    dynamicRoutes: Array<{\n      page: string\n      regex: string\n      namedRegex?: string\n      routeKeys?: { [key: string]: string }\n    }>\n    dataRoutes: Array<{\n      page: string\n      routeKeys?: { [key: string]: string }\n      dataRouteRegex: string\n      namedDataRouteRegex?: string\n    }>\n    i18n?: {\n      locales: string[]\n      defaultLocale: string[]\n      domains: Array<{\n        domain: string\n        defaultLocale: string\n        locales: string[]\n      }>\n    }\n  } = {\n    version: 3,\n    pages404: true,\n    basePath: config.basePath,\n    redirects: redirects.map((r) => buildCustomRoute(r, 'redirect')),\n    rewrites: rewrites.map((r) => buildCustomRoute(r, 'rewrite')),\n    headers: headers.map((r) => buildCustomRoute(r, 'header')),\n    dynamicRoutes: getSortedRoutes(pageKeys)\n      .filter(isDynamicRoute)\n      .map((page) => {\n        const routeRegex = getRouteRegex(page)\n        return {\n          page,\n          regex: normalizeRouteRegex(routeRegex.re.source),\n          routeKeys: routeRegex.routeKeys,\n          namedRegex: routeRegex.namedRegex,\n        }\n      }),\n    dataRoutes: [],\n    i18n: config.i18n || undefined,\n  }\n\n  await promises.mkdir(distDir, { recursive: true })\n  // We need to write the manifest with rewrites before build\n  // so serverless can import the manifest\n  await promises.writeFile(\n    routesManifestPath,\n    JSON.stringify(routesManifest),\n    'utf8'\n  )\n\n  const configs = await Promise.all([\n    getBaseWebpackConfig(dir, {\n      tracer,\n      buildId,\n      reactProductionProfiling,\n      isServer: false,\n      config,\n      target,\n      pagesDir,\n      entrypoints: entrypoints.client,\n      rewrites,\n    }),\n    getBaseWebpackConfig(dir, {\n      tracer,\n      buildId,\n      reactProductionProfiling,\n      isServer: true,\n      config,\n      target,\n      pagesDir,\n      entrypoints: entrypoints.server,\n      rewrites,\n    }),\n  ])\n\n  const clientConfig = configs[0]\n\n  if (\n    clientConfig.optimization &&\n    (clientConfig.optimization.minimize !== true ||\n      (clientConfig.optimization.minimizer &&\n        clientConfig.optimization.minimizer.length === 0))\n  ) {\n    Log.warn(\n      `Production code optimization has been disabled in your project. Read more: https://err.sh/vercel/next.js/minification-disabled`\n    )\n  }\n\n  const webpackBuildStart = process.hrtime()\n\n  let result: CompilerResult = { warnings: [], errors: [] }\n  // TODO: why do we need this?? https://github.com/vercel/next.js/issues/8253\n  if (isLikeServerless) {\n    const clientResult = await runCompiler(clientConfig)\n    // Fail build if clientResult contains errors\n    if (clientResult.errors.length > 0) {\n      result = {\n        warnings: [...clientResult.warnings],\n        errors: [...clientResult.errors],\n      }\n    } else {\n      const serverResult = await runCompiler(configs[1])\n      result = {\n        warnings: [...clientResult.warnings, ...serverResult.warnings],\n        errors: [...clientResult.errors, ...serverResult.errors],\n      }\n    }\n  } else {\n    result = await runCompiler(configs)\n  }\n\n  const webpackBuildEnd = process.hrtime(webpackBuildStart)\n  if (buildSpinner) {\n    buildSpinner.stopAndPersist()\n  }\n\n  result = formatWebpackMessages(result)\n\n  if (result.errors.length > 0) {\n    // Only keep the first error. Others are often indicative\n    // of the same problem, but confuse the reader with noise.\n    if (result.errors.length > 1) {\n      result.errors.length = 1\n    }\n    const error = result.errors.join('\\n\\n')\n\n    console.error(chalk.red('Failed to compile.\\n'))\n\n    if (\n      error.indexOf('private-next-pages') > -1 &&\n      error.indexOf('does not contain a default export') > -1\n    ) {\n      const page_name_regex = /'private-next-pages\\/(?<page_name>[^']*)'/\n      const parsed = page_name_regex.exec(error)\n      const page_name = parsed && parsed.groups && parsed.groups.page_name\n      throw new Error(\n        `webpack build failed: found page without a React Component as default export in pages/${page_name}\\n\\nSee https://err.sh/vercel/next.js/page-without-valid-component for more info.`\n      )\n    }\n\n    console.error(error)\n    console.error()\n\n    if (\n      error.indexOf('private-next-pages') > -1 ||\n      error.indexOf('__next_polyfill__') > -1\n    ) {\n      throw new Error(\n        '> webpack config.resolve.alias was incorrectly overridden. https://err.sh/vercel/next.js/invalid-resolve-alias'\n      )\n    }\n    throw new Error('> Build failed because of webpack errors')\n  } else {\n    telemetry.record(\n      eventBuildCompleted(pagePaths, {\n        durationInSeconds: webpackBuildEnd[0],\n      })\n    )\n\n    if (result.warnings.length > 0) {\n      Log.warn('Compiled with warnings\\n')\n      console.warn(result.warnings.join('\\n\\n'))\n      console.warn()\n    } else {\n      Log.info('Compiled successfully')\n    }\n  }\n\n  const postCompileSpinner = createSpinner({\n    prefixText: `${Log.prefixes.info} Collecting page data`,\n  })\n\n  const manifestPath = path.join(\n    distDir,\n    isLikeServerless ? SERVERLESS_DIRECTORY : SERVER_DIRECTORY,\n    PAGES_MANIFEST\n  )\n  const buildManifestPath = path.join(distDir, BUILD_MANIFEST)\n\n  const ssgPages = new Set<string>()\n  const ssgStaticFallbackPages = new Set<string>()\n  const ssgBlockingFallbackPages = new Set<string>()\n  const staticPages = new Set<string>()\n  const invalidPages = new Set<string>()\n  const hybridAmpPages = new Set<string>()\n  const serverPropsPages = new Set<string>()\n  const additionalSsgPaths = new Map<string, Array<string>>()\n  const pageInfos = new Map<string, PageInfo>()\n  const pagesManifest = JSON.parse(\n    await promises.readFile(manifestPath, 'utf8')\n  ) as PagesManifest\n  const buildManifest = JSON.parse(\n    await promises.readFile(buildManifestPath, 'utf8')\n  ) as BuildManifest\n\n  let customAppGetInitialProps: boolean | undefined\n  let namedExports: Array<string> | undefined\n  let isNextImageImported: boolean | undefined\n\n  process.env.NEXT_PHASE = PHASE_PRODUCTION_BUILD\n\n  const staticCheckWorkers = new Worker(staticCheckWorker, {\n    numWorkers: config.experimental.cpus,\n    enableWorkerThreads: config.experimental.workerThreads,\n  }) as Worker & { isPageStatic: typeof isPageStatic }\n\n  staticCheckWorkers.getStdout().pipe(process.stdout)\n  staticCheckWorkers.getStderr().pipe(process.stderr)\n\n  const runtimeEnvConfig = {\n    publicRuntimeConfig: config.publicRuntimeConfig,\n    serverRuntimeConfig: config.serverRuntimeConfig,\n  }\n\n  hasNonStaticErrorPage =\n    hasCustomErrorPage &&\n    (await hasCustomGetInitialProps(\n      getPagePath('/_error', distDir, isLikeServerless),\n      runtimeEnvConfig,\n      false\n    ))\n\n  const analysisBegin = process.hrtime()\n  await Promise.all(\n    pageKeys.map(async (page) => {\n      const actualPage = normalizePagePath(page)\n      const [selfSize, allSize] = await getJsPageSizeInKb(\n        actualPage,\n        distDir,\n        buildManifest\n      )\n\n      let isSsg = false\n      let isStatic = false\n      let isHybridAmp = false\n      let ssgPageRoutes: string[] | null = null\n\n      const nonReservedPage = !page.match(\n        /^\\/(_app|_error|_document|api(\\/|$))/\n      )\n\n      if (nonReservedPage) {\n        const serverBundle = getPagePath(page, distDir, isLikeServerless)\n\n        if (customAppGetInitialProps === undefined) {\n          customAppGetInitialProps = await hasCustomGetInitialProps(\n            isLikeServerless\n              ? serverBundle\n              : getPagePath('/_app', distDir, isLikeServerless),\n            runtimeEnvConfig,\n            true\n          )\n\n          namedExports = getNamedExports(\n            isLikeServerless\n              ? serverBundle\n              : getPagePath('/_app', distDir, isLikeServerless),\n            runtimeEnvConfig\n          )\n\n          if (customAppGetInitialProps) {\n            console.warn(\n              chalk.bold.yellow(`Warning: `) +\n                chalk.yellow(\n                  `You have opted-out of Automatic Static Optimization due to \\`getInitialProps\\` in \\`pages/_app\\`. This does not opt-out pages with \\`getStaticProps\\``\n                )\n            )\n            console.warn(\n              'Read more: https://err.sh/next.js/opt-out-auto-static-optimization\\n'\n            )\n          }\n        }\n\n        try {\n          let workerResult = await staticCheckWorkers.isPageStatic(\n            page,\n            serverBundle,\n            runtimeEnvConfig,\n            config.i18n?.locales,\n            config.i18n?.defaultLocale\n          )\n\n          if (workerResult.isHybridAmp) {\n            isHybridAmp = true\n            hybridAmpPages.add(page)\n          }\n\n          if (workerResult.isNextImageImported) {\n            isNextImageImported = true\n          }\n\n          if (workerResult.hasStaticProps) {\n            ssgPages.add(page)\n            isSsg = true\n\n            if (workerResult.prerenderRoutes) {\n              additionalSsgPaths.set(page, workerResult.prerenderRoutes)\n              ssgPageRoutes = workerResult.prerenderRoutes\n            }\n\n            if (workerResult.prerenderFallback === 'blocking') {\n              ssgBlockingFallbackPages.add(page)\n            } else if (workerResult.prerenderFallback === true) {\n              ssgStaticFallbackPages.add(page)\n            }\n          } else if (workerResult.hasServerProps) {\n            serverPropsPages.add(page)\n          } else if (\n            workerResult.isStatic &&\n            customAppGetInitialProps === false\n          ) {\n            staticPages.add(page)\n            isStatic = true\n          }\n\n          if (hasPages404 && page === '/404') {\n            if (!workerResult.isStatic && !workerResult.hasStaticProps) {\n              throw new Error(PAGES_404_GET_INITIAL_PROPS_ERROR)\n            }\n            // we need to ensure the 404 lambda is present since we use\n            // it when _app has getInitialProps\n            if (customAppGetInitialProps && !workerResult.hasStaticProps) {\n              staticPages.delete(page)\n            }\n          }\n        } catch (err) {\n          if (err.message !== 'INVALID_DEFAULT_EXPORT') throw err\n          invalidPages.add(page)\n        }\n      }\n\n      pageInfos.set(page, {\n        size: selfSize,\n        totalSize: allSize,\n        static: isStatic,\n        isSsg,\n        isHybridAmp,\n        ssgPageRoutes,\n        initialRevalidateSeconds: false,\n      })\n    })\n  )\n  staticCheckWorkers.end()\n\n  if (serverPropsPages.size > 0 || ssgPages.size > 0) {\n    // We update the routes manifest after the build with the\n    // data routes since we can't determine these until after build\n    routesManifest.dataRoutes = getSortedRoutes([\n      ...serverPropsPages,\n      ...ssgPages,\n    ]).map((page) => {\n      const pagePath = normalizePagePath(page)\n      const dataRoute = path.posix.join(\n        '/_next/data',\n        buildId,\n        `${pagePath}.json`\n      )\n\n      let dataRouteRegex: string\n      let namedDataRouteRegex: string | undefined\n      let routeKeys: { [named: string]: string } | undefined\n\n      if (isDynamicRoute(page)) {\n        const routeRegex = getRouteRegex(dataRoute.replace(/\\.json$/, ''))\n\n        dataRouteRegex = normalizeRouteRegex(\n          routeRegex.re.source.replace(/\\(\\?:\\\\\\/\\)\\?\\$$/, '\\\\.json$')\n        )\n        namedDataRouteRegex = routeRegex.namedRegex!.replace(\n          /\\(\\?:\\/\\)\\?\\$$/,\n          '\\\\.json$'\n        )\n        routeKeys = routeRegex.routeKeys\n      } else {\n        dataRouteRegex = normalizeRouteRegex(\n          new RegExp(\n            `^${path.posix.join(\n              '/_next/data',\n              escapeStringRegexp(buildId),\n              `${pagePath}.json`\n            )}$`\n          ).source\n        )\n      }\n\n      return {\n        page,\n        routeKeys,\n        dataRouteRegex,\n        namedDataRouteRegex,\n      }\n    })\n\n    await promises.writeFile(\n      routesManifestPath,\n      JSON.stringify(routesManifest),\n      'utf8'\n    )\n  }\n\n  // Since custom _app.js can wrap the 404 page we have to opt-out of static optimization if it has getInitialProps\n  // Only export the static 404 when there is no /_error present\n  const useStatic404 =\n    !customAppGetInitialProps && (!hasNonStaticErrorPage || hasPages404)\n\n  if (invalidPages.size > 0) {\n    throw new Error(\n      `Build optimization failed: found page${\n        invalidPages.size === 1 ? '' : 's'\n      } without a React Component as default export in \\n${[...invalidPages]\n        .map((pg) => `pages${pg}`)\n        .join(\n          '\\n'\n        )}\\n\\nSee https://err.sh/vercel/next.js/page-without-valid-component for more info.\\n`\n    )\n  }\n\n  await writeBuildId(distDir, buildId)\n\n  const finalPrerenderRoutes: { [route: string]: SsgRoute } = {}\n  const tbdPrerenderRoutes: string[] = []\n  let ssgNotFoundPaths: string[] = []\n\n  if (postCompileSpinner) postCompileSpinner.stopAndPersist()\n\n  if (staticPages.size > 0 || ssgPages.size > 0 || useStatic404) {\n    const combinedPages = [...staticPages, ...ssgPages]\n    const exportApp = require('../export').default\n    const exportOptions = {\n      silent: false,\n      buildExport: true,\n      threads: config.experimental.cpus,\n      pages: combinedPages,\n      outdir: path.join(distDir, 'export'),\n      statusMessage: 'Generating static pages',\n    }\n    const exportConfig: any = {\n      ...config,\n      initialPageRevalidationMap: {},\n      ssgNotFoundPaths: [] as string[],\n      // Default map will be the collection of automatic statically exported\n      // pages and incremental pages.\n      // n.b. we cannot handle this above in combinedPages because the dynamic\n      // page must be in the `pages` array, but not in the mapping.\n      exportPathMap: (defaultMap: any) => {\n        const { i18n } = config\n\n        // Dynamically routed pages should be prerendered to be used as\n        // a client-side skeleton (fallback) while data is being fetched.\n        // This ensures the end-user never sees a 500 or slow response from the\n        // server.\n        //\n        // Note: prerendering disables automatic static optimization.\n        ssgPages.forEach((page) => {\n          if (isDynamicRoute(page)) {\n            tbdPrerenderRoutes.push(page)\n\n            if (ssgStaticFallbackPages.has(page)) {\n              // Override the rendering for the dynamic page to be treated as a\n              // fallback render.\n              if (i18n) {\n                defaultMap[`/${i18n.defaultLocale}${page}`] = {\n                  page,\n                  query: { __nextFallback: true },\n                }\n              } else {\n                defaultMap[page] = { page, query: { __nextFallback: true } }\n              }\n            } else {\n              // Remove dynamically routed pages from the default path map when\n              // fallback behavior is disabled.\n              delete defaultMap[page]\n            }\n          }\n        })\n        // Append the \"well-known\" routes we should prerender for, e.g. blog\n        // post slugs.\n        additionalSsgPaths.forEach((routes, page) => {\n          routes.forEach((route) => {\n            defaultMap[route] = { page }\n          })\n        })\n\n        if (useStatic404) {\n          defaultMap['/404'] = {\n            page: hasPages404 ? '/404' : '/_error',\n          }\n        }\n\n        if (i18n) {\n          for (const page of [\n            ...staticPages,\n            ...ssgPages,\n            ...(useStatic404 ? ['/404'] : []),\n          ]) {\n            const isSsg = ssgPages.has(page)\n            const isDynamic = isDynamicRoute(page)\n            const isFallback = isSsg && ssgStaticFallbackPages.has(page)\n\n            for (const locale of i18n.locales) {\n              // skip fallback generation for SSG pages without fallback mode\n              if (isSsg && isDynamic && !isFallback) continue\n              const outputPath = `/${locale}${page === '/' ? '' : page}`\n\n              defaultMap[outputPath] = {\n                page: defaultMap[page]?.page || page,\n                query: { __nextLocale: locale },\n              }\n\n              if (isFallback) {\n                defaultMap[outputPath].query.__nextFallback = true\n              }\n            }\n\n            if (isSsg) {\n              // remove non-locale prefixed variant from defaultMap\n              delete defaultMap[page]\n            }\n          }\n        }\n\n        return defaultMap\n      },\n      trailingSlash: false,\n    }\n\n    await exportApp(dir, exportOptions, exportConfig)\n\n    const postBuildSpinner = createSpinner({\n      prefixText: `${Log.prefixes.info} Finalizing page optimization`,\n    })\n    ssgNotFoundPaths = exportConfig.ssgNotFoundPaths\n\n    // remove server bundles that were exported\n    for (const page of staticPages) {\n      const serverBundle = getPagePath(page, distDir, isLikeServerless)\n      await promises.unlink(serverBundle)\n    }\n    const serverOutputDir = path.join(\n      distDir,\n      isLikeServerless ? SERVERLESS_DIRECTORY : SERVER_DIRECTORY\n    )\n\n    const moveExportedPage = async (\n      originPage: string,\n      page: string,\n      file: string,\n      isSsg: boolean,\n      ext: 'html' | 'json',\n      additionalSsgFile = false\n    ) => {\n      file = `${file}.${ext}`\n      const orig = path.join(exportOptions.outdir, file)\n      const pagePath = getPagePath(originPage, distDir, isLikeServerless)\n\n      const relativeDest = path\n        .relative(\n          serverOutputDir,\n          path.join(\n            path.join(\n              pagePath,\n              // strip leading / and then recurse number of nested dirs\n              // to place from base folder\n              originPage\n                .substr(1)\n                .split('/')\n                .map(() => '..')\n                .join('/')\n            ),\n            file\n          )\n        )\n        .replace(/\\\\/g, '/')\n\n      const dest = path.join(\n        distDir,\n        isLikeServerless ? SERVERLESS_DIRECTORY : SERVER_DIRECTORY,\n        relativeDest\n      )\n\n      if (!isSsg) {\n        pagesManifest[page] = relativeDest\n      }\n\n      const { i18n } = config\n      const isNotFound = ssgNotFoundPaths.includes(page)\n\n      // for SSG files with i18n the non-prerendered variants are\n      // output with the locale prefixed so don't attempt moving\n      // without the prefix\n      if ((!i18n || additionalSsgFile) && !isNotFound) {\n        await promises.mkdir(path.dirname(dest), { recursive: true })\n        await promises.rename(orig, dest)\n      } else if (i18n && !isSsg) {\n        // this will be updated with the locale prefixed variant\n        // since all files are output with the locale prefix\n        delete pagesManifest[page]\n      }\n\n      if (i18n) {\n        if (additionalSsgFile) return\n\n        for (const locale of i18n.locales) {\n          const curPath = `/${locale}${page === '/' ? '' : page}`\n          const localeExt = page === '/' ? path.extname(file) : ''\n          const relativeDestNoPages = relativeDest.substr('pages/'.length)\n\n          if (isSsg && ssgNotFoundPaths.includes(curPath)) {\n            continue\n          }\n\n          const updatedRelativeDest = path.join(\n            'pages',\n            locale + localeExt,\n            // if it's the top-most index page we want it to be locale.EXT\n            // instead of locale/index.html\n            page === '/' ? '' : relativeDestNoPages\n          )\n          const updatedOrig = path.join(\n            exportOptions.outdir,\n            locale + localeExt,\n            page === '/' ? '' : file\n          )\n          const updatedDest = path.join(\n            distDir,\n            isLikeServerless ? SERVERLESS_DIRECTORY : SERVER_DIRECTORY,\n            updatedRelativeDest\n          )\n\n          if (!isSsg) {\n            pagesManifest[curPath] = updatedRelativeDest\n          }\n          await promises.mkdir(path.dirname(updatedDest), { recursive: true })\n          await promises.rename(updatedOrig, updatedDest)\n        }\n      }\n    }\n\n    // Only move /404 to /404 when there is no custom 404 as in that case we don't know about the 404 page\n    if (!hasPages404 && useStatic404) {\n      await moveExportedPage('/_error', '/404', '/404', false, 'html')\n    }\n\n    for (const page of combinedPages) {\n      const isSsg = ssgPages.has(page)\n      const isStaticSsgFallback = ssgStaticFallbackPages.has(page)\n      const isDynamic = isDynamicRoute(page)\n      const hasAmp = hybridAmpPages.has(page)\n      const file = normalizePagePath(page)\n\n      // The dynamic version of SSG pages are only prerendered if the fallback\n      // is enabled. Below, we handle the specific prerenders of these.\n      if (!(isSsg && isDynamic && !isStaticSsgFallback)) {\n        await moveExportedPage(page, page, file, isSsg, 'html')\n      }\n\n      if (hasAmp && (!isSsg || (isSsg && !isDynamic))) {\n        const ampPage = `${file}.amp`\n        await moveExportedPage(page, ampPage, ampPage, isSsg, 'html')\n\n        if (isSsg) {\n          await moveExportedPage(page, ampPage, ampPage, isSsg, 'json')\n        }\n      }\n\n      if (isSsg) {\n        const { i18n } = config\n\n        // For a non-dynamic SSG page, we must copy its data file from export.\n        if (!isDynamic) {\n          await moveExportedPage(page, page, file, true, 'json')\n\n          const revalidationMapPath = i18n\n            ? `/${i18n.defaultLocale}${page === '/' ? '' : page}`\n            : page\n\n          finalPrerenderRoutes[page] = {\n            initialRevalidateSeconds:\n              exportConfig.initialPageRevalidationMap[revalidationMapPath],\n            srcRoute: null,\n            dataRoute: path.posix.join('/_next/data', buildId, `${file}.json`),\n          }\n          // Set Page Revalidation Interval\n          const pageInfo = pageInfos.get(page)\n          if (pageInfo) {\n            pageInfo.initialRevalidateSeconds =\n              exportConfig.initialPageRevalidationMap[revalidationMapPath]\n            pageInfos.set(page, pageInfo)\n          }\n        } else {\n          // For a dynamic SSG page, we did not copy its data exports and only\n          // copy the fallback HTML file (if present).\n          // We must also copy specific versions of this page as defined by\n          // `getStaticPaths` (additionalSsgPaths).\n          const extraRoutes = additionalSsgPaths.get(page) || []\n          for (const route of extraRoutes) {\n            const pageFile = normalizePagePath(route)\n            await moveExportedPage(page, route, pageFile, true, 'html', true)\n            await moveExportedPage(page, route, pageFile, true, 'json', true)\n\n            if (hasAmp) {\n              const ampPage = `${pageFile}.amp`\n              await moveExportedPage(page, ampPage, ampPage, true, 'html', true)\n              await moveExportedPage(page, ampPage, ampPage, true, 'json', true)\n            }\n\n            finalPrerenderRoutes[route] = {\n              initialRevalidateSeconds:\n                exportConfig.initialPageRevalidationMap[route],\n              srcRoute: page,\n              dataRoute: path.posix.join(\n                '/_next/data',\n                buildId,\n                `${normalizePagePath(route)}.json`\n              ),\n            }\n\n            // Set route Revalidation Interval\n            const pageInfo = pageInfos.get(route)\n            if (pageInfo) {\n              pageInfo.initialRevalidateSeconds =\n                exportConfig.initialPageRevalidationMap[route]\n              pageInfos.set(route, pageInfo)\n            }\n          }\n        }\n      }\n    }\n\n    // remove temporary export folder\n    await recursiveDelete(exportOptions.outdir)\n    await promises.rmdir(exportOptions.outdir)\n    await promises.writeFile(\n      manifestPath,\n      JSON.stringify(pagesManifest, null, 2),\n      'utf8'\n    )\n\n    if (postBuildSpinner) postBuildSpinner.stopAndPersist()\n    console.log()\n  }\n\n  const analysisEnd = process.hrtime(analysisBegin)\n  telemetry.record(\n    eventBuildOptimize(pagePaths, {\n      durationInSeconds: analysisEnd[0],\n      staticPageCount: staticPages.size,\n      staticPropsPageCount: ssgPages.size,\n      serverPropsPageCount: serverPropsPages.size,\n      ssrPageCount:\n        pagePaths.length -\n        (staticPages.size + ssgPages.size + serverPropsPages.size),\n      hasStatic404: useStatic404,\n      hasReportWebVitals: namedExports?.includes('reportWebVitals') ?? false,\n      rewritesCount: rewrites.length,\n      headersCount: headers.length,\n      redirectsCount: redirects.length - 1, // reduce one for trailing slash\n    })\n  )\n\n  if (ssgPages.size > 0) {\n    const finalDynamicRoutes: PrerenderManifest['dynamicRoutes'] = {}\n    tbdPrerenderRoutes.forEach((tbdRoute) => {\n      const normalizedRoute = normalizePagePath(tbdRoute)\n      const dataRoute = path.posix.join(\n        '/_next/data',\n        buildId,\n        `${normalizedRoute}.json`\n      )\n\n      finalDynamicRoutes[tbdRoute] = {\n        routeRegex: normalizeRouteRegex(getRouteRegex(tbdRoute).re.source),\n        dataRoute,\n        fallback: ssgBlockingFallbackPages.has(tbdRoute)\n          ? null\n          : ssgStaticFallbackPages.has(tbdRoute)\n          ? `${normalizedRoute}.html`\n          : false,\n        dataRouteRegex: normalizeRouteRegex(\n          getRouteRegex(dataRoute.replace(/\\.json$/, '')).re.source.replace(\n            /\\(\\?:\\\\\\/\\)\\?\\$$/,\n            '\\\\.json$'\n          )\n        ),\n      }\n    })\n    const prerenderManifest: PrerenderManifest = {\n      version: 2,\n      routes: finalPrerenderRoutes,\n      dynamicRoutes: finalDynamicRoutes,\n      notFoundRoutes: ssgNotFoundPaths,\n      preview: previewProps,\n    }\n\n    await promises.writeFile(\n      path.join(distDir, PRERENDER_MANIFEST),\n      JSON.stringify(prerenderManifest),\n      'utf8'\n    )\n    await generateClientSsgManifest(prerenderManifest, {\n      distDir,\n      buildId,\n    })\n  } else {\n    const prerenderManifest: PrerenderManifest = {\n      version: 2,\n      routes: {},\n      dynamicRoutes: {},\n      preview: previewProps,\n      notFoundRoutes: [],\n    }\n    await promises.writeFile(\n      path.join(distDir, PRERENDER_MANIFEST),\n      JSON.stringify(prerenderManifest),\n      'utf8'\n    )\n  }\n\n  const images = { ...config.images }\n  const { deviceSizes, imageSizes } = images\n  images.sizes = [...deviceSizes, ...imageSizes]\n\n  await promises.writeFile(\n    path.join(distDir, IMAGES_MANIFEST),\n    JSON.stringify({\n      version: 1,\n      images,\n    }),\n    'utf8'\n  )\n\n  await promises.writeFile(\n    path.join(distDir, EXPORT_MARKER),\n    JSON.stringify({\n      version: 1,\n      hasExportPathMap: typeof config.exportPathMap === 'function',\n      exportTrailingSlash: config.trailingSlash === true,\n      isNextImageImported: isNextImageImported === true,\n    }),\n    'utf8'\n  )\n  await promises.unlink(path.join(distDir, EXPORT_DETAIL)).catch((err) => {\n    if (err.code === 'ENOENT') {\n      return Promise.resolve()\n    }\n    return Promise.reject(err)\n  })\n\n  staticPages.forEach((pg) => allStaticPages.add(pg))\n  pageInfos.forEach((info: PageInfo, key: string) => {\n    allPageInfos.set(key, info)\n  })\n\n  await printTreeView(\n    Object.keys(mappedPages),\n    allPageInfos,\n    isLikeServerless,\n    {\n      distPath: distDir,\n      buildId: buildId,\n      pagesDir,\n      useStatic404,\n      pageExtensions: config.pageExtensions,\n      buildManifest,\n    }\n  )\n\n  if (debugOutput) {\n    printCustomRoutes({ redirects, rewrites, headers })\n  }\n\n  if (config.analyticsId) {\n    console.log(\n      chalk.bold.green('Next.js Analytics') +\n        ' is enabled for this production build. ' +\n        \"You'll receive a Real Experience Score computed by all of your visitors.\"\n    )\n    console.log('')\n  }\n\n  if (tracer) {\n    const parsedResults = await tracer.profiler.stopProfiling()\n    await new Promise((resolve) => {\n      if (parsedResults === undefined) {\n        tracer.profiler.destroy()\n        tracer.trace.flush()\n        tracer.end(resolve)\n        return\n      }\n\n      const cpuStartTime = parsedResults.profile.startTime\n      const cpuEndTime = parsedResults.profile.endTime\n\n      tracer.trace.completeEvent({\n        name: 'TaskQueueManager::ProcessTaskFromWorkQueue',\n        id: ++tracer.counter,\n        cat: ['toplevel'],\n        ts: cpuStartTime,\n        args: {\n          src_file: '../../ipc/ipc_moji_bootstrap.cc',\n          src_func: 'Accept',\n        },\n      })\n\n      tracer.trace.completeEvent({\n        name: 'EvaluateScript',\n        id: ++tracer.counter,\n        cat: ['devtools.timeline'],\n        ts: cpuStartTime,\n        dur: cpuEndTime - cpuStartTime,\n        args: {\n          data: {\n            url: 'webpack',\n            lineNumber: 1,\n            columnNumber: 1,\n            frame: '0xFFF',\n          },\n        },\n      })\n\n      tracer.trace.instantEvent({\n        name: 'CpuProfile',\n        id: ++tracer.counter,\n        cat: ['disabled-by-default-devtools.timeline'],\n        ts: cpuEndTime,\n        args: {\n          data: {\n            cpuProfile: parsedResults.profile,\n          },\n        },\n      })\n\n      tracer.profiler.destroy()\n      tracer.trace.flush()\n      tracer.end(resolve)\n    })\n  }\n\n  await telemetry.flush()\n}\n\nexport type ClientSsgManifest = Set<string>\n\nfunction generateClientSsgManifest(\n  prerenderManifest: PrerenderManifest,\n  { buildId, distDir }: { buildId: string; distDir: string }\n) {\n  const ssgPages: ClientSsgManifest = new Set<string>([\n    ...Object.entries(prerenderManifest.routes)\n      // Filter out dynamic routes\n      .filter(([, { srcRoute }]) => srcRoute == null)\n      .map(([route]) => route),\n    ...Object.keys(prerenderManifest.dynamicRoutes),\n  ])\n\n  const clientSsgManifestContent = `self.__SSG_MANIFEST=${devalue(\n    ssgPages\n  )};self.__SSG_MANIFEST_CB&&self.__SSG_MANIFEST_CB()`\n\n  writeFileSync(\n    path.join(distDir, CLIENT_STATIC_FILES_PATH, buildId, '_ssgManifest.js'),\n    clientSsgManifestContent\n  )\n}\n"]}