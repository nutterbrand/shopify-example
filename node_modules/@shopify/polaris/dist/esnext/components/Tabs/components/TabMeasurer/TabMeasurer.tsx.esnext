import React$1, { memo, useRef, useCallback, useEffect } from 'react';
import { EventListener as EventListener$1 } from '../../../EventListener/EventListener.tsx.esnext';
import { classNames } from '../../../../utilities/css.ts.esnext';
import { useComponentDidMount as useComponentDidMount$1 } from '../../../../utilities/use-component-did-mount.ts.esnext';
import styles from '../../Tabs.scss.esnext';
import { Tab as Tab$1 } from '../Tab/Tab.tsx.esnext';

const TabMeasurer = /*#__PURE__*/memo(function TabMeasurer({
  selected,
  tabs,
  activator,
  tabToFocus,
  siblingTabHasFocus,
  handleMeasurement: handleMeasurementProp
}) {
  const containerNode = useRef(null);
  const animationFrame = useRef(null);
  const handleMeasurement = useCallback(() => {
    if (animationFrame.current) {
      cancelAnimationFrame(animationFrame.current);
    }

    animationFrame.current = requestAnimationFrame(() => {
      if (!containerNode.current) {
        return;
      }

      const containerWidth = containerNode.current.offsetWidth;
      const hiddenTabNodes = containerNode.current.children;
      const hiddenTabNodesArray = Array.from(hiddenTabNodes);
      const hiddenTabWidths = hiddenTabNodesArray.map(node => {
        return node.getBoundingClientRect().width;
      });
      const disclosureWidth = hiddenTabWidths.pop() || 0;
      handleMeasurementProp({
        containerWidth,
        disclosureWidth,
        hiddenTabWidths
      });
    });
  }, [handleMeasurementProp]);
  useEffect(() => {
    handleMeasurement();
  }, [handleMeasurement, tabs]);
  useComponentDidMount$1(() => {
    if (process.env.NODE_ENV === 'development') {
      setTimeout(handleMeasurement, 0);
    }
  });
  const tabsMarkup = tabs.map((tab, index) => {
    return /*#__PURE__*/React$1.createElement(Tab$1, {
      measuring: true,
      key: `${index}${tab.id}Hidden`,
      id: `${tab.id}Measurer`,
      siblingTabHasFocus: siblingTabHasFocus,
      focused: index === tabToFocus,
      selected: index === selected,
      onClick: noop,
      url: tab.url
    }, tab.content);
  });
  const classname = classNames(styles.Tabs, styles.TabMeasurer);
  return /*#__PURE__*/React$1.createElement("div", {
    className: classname,
    ref: containerNode
  }, /*#__PURE__*/React$1.createElement(EventListener$1, {
    event: "resize",
    handler: handleMeasurement
  }), tabsMarkup, activator);
});

function noop() {}

export { TabMeasurer };
